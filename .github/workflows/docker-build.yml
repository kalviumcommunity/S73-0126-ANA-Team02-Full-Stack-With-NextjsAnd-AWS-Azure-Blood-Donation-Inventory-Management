name: Docker Build

on:
  push:
    branches: ['main']

jobs:
  build-image:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        # Brings the repo files into the runner workspace.
        uses: actions/checkout@v4

      - name: Setup Node.js
        # Some projects run lint or build steps pre-docker; we set Node for consistency.
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: Build Docker image
        # Builds the Docker image using the Dockerfile in the repo.
        # No secrets are hardcoded; if environment variables are needed, use GitHub Secrets and pass via --build-arg or docker run in a later job.
        run: |
          IMAGE_NAME="blood-inventory"
          IMAGE_TAG="${{ github.sha }}"
          docker build -t "$IMAGE_NAME:$IMAGE_TAG" .

      - name: Show built images
        # Lists the image to verify the build output in CI logs.
        run: docker images | grep blood-inventory || true
